---

title: Forecast Notebook


keywords: fastai
sidebar: home_sidebar



nb_path: "Forecast.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: Forecast.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Getting-Data-Ready">Getting Data Ready<a class="anchor-link" href="#Getting-Data-Ready"> </a></h1><p>The overall process for  using Amazon Forecast is the following:</p>
<ol>
<li>Create a Dataset Group, this is the large box that isolates models and the data they are trained on from each other.</li>
<li>Create a Dataset, in Forecast there are 3 types of dataset, Target Time Series, Related Time Series, and Item Metadata. The Target Time Series is required, the others provide additional context with certain algorithms. </li>
<li>Import data, this moves the information from S3 into a storage volume where the data can be used for training and validation.</li>
<li>Train a model, Forecast automates this process for you but you can also select particular algorithms, and you can provide your own hyper parameters or use Hyper Parameter Optimization(HPO) to determine the most performant values for you.</li>
<li>Deploy a Predictor, here you are deploying your model so you can use it to generate a forecast.</li>
<li>Query the Forecast, given a request bounded by time for an item, return the forecast for it. Once you have this you can evaluate its performance or use it to guide your decisions about the future.</li>
<li>Export the Forecast , export your forecast result to s3 bucket and you can easilt access it.</li>
</ol>
<p><strong>Read Every Cell FULLY before executing it</strong></p>
<p>For more informations about APIs, please check the <a href="https://docs.aws.amazon.com/forecast/latest/dg/what-is-forecast.html">documentation</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setup">Setup<a class="anchor-link" href="#Setup"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Import the standard Python libraries that are used in this lesson.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">util</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Configure the S3 bucket name for all the Forecasting outputs and region name for this lesson.</p>
<ul>
<li>If you don't have an S3 bucket, create it first on S3. OR If you used CloudFormation Wizard to set up the environment, use same bucket name as you specified in the setup process.</li>
<li>Although we have set the region to us-east-1 as a default value below, you can choose any of the regions that the service is available in.</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">text_widget_bucket</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">create_text_widget</span><span class="p">(</span> <span class="s2">&quot;bucket_name&quot;</span><span class="p">,</span> <span class="s2">&quot;input your S3 bucket name&quot;</span> <span class="p">)</span>
<span class="n">text_widget_region</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">create_text_widget</span><span class="p">(</span> <span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="s2">&quot;input region name.&quot;</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="s2">&quot;us-east-1&quot;</span> <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bucket_name</span> <span class="o">=</span> <span class="n">text_widget_bucket</span><span class="o">.</span><span class="n">value</span>
<span class="k">assert</span> <span class="n">bucket_name</span><span class="p">,</span> <span class="s2">&quot;bucket_name not set.&quot;</span>

<span class="n">region</span> <span class="o">=</span> <span class="n">text_widget_region</span><span class="o">.</span><span class="n">value</span>
<span class="k">assert</span> <span class="n">region</span><span class="p">,</span> <span class="s2">&quot;region not set.&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The last part of the setup process is to validate that your account can communicate with Amazon Forecast, the cell below does just that.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="n">region</span><span class="p">)</span> 
<span class="n">forecast</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="s1">&#39;forecast&#39;</span><span class="p">)</span> 
<span class="n">forecastquery</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="s1">&#39;forecastquery&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-Preparation">Data Preparation<a class="anchor" id="DataPrep" /><a class="anchor-link" href="#Data-Preparation"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Input-S3-bucket-(raw-data)">Input S3 bucket (raw data)<a class="anchor-link" href="#Input-S3-bucket-(raw-data)"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For tetsing Execute only below cell(Raw data is present locally)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/item-demand-time.csv&quot;</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">object</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;item&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If raw data is present in S3 Bucket</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s3_bucket</span> <span class="o">=</span> <span class="s2">&quot;bucket_name&quot;</span>
<span class="n">s3_input_prefix</span> <span class="o">=</span> <span class="s1">&#39;prefix_name&#39;</span>
<span class="n">s3_input_filename</span> <span class="o">=</span> <span class="s1">&#39;filename&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="n">s3_bucket</span><span class="p">,</span> <span class="n">s3_input_prefix</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">s3_input_filename</span><span class="p">)</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">()[</span><span class="s1">&#39;Body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">body</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notice in the output above there are 3 columns of data:</p>
<ol>
<li>The Timestamp</li>
<li>A Value</li>
<li>An Item</li>
</ol>
<p>These are the 3 key required pieces of information to generate a forecast with Amazon Forecast. More can be added but these 3 must always remain present.</p>
<p><strong>If you want to train yoir model only you can skip this cells and firectly run the "Create the Dataset Group and Dataset"</strong></p>
<p>Example:- The dataset happens to span January 01, 2014 to Deceber 31, 2014. For our testing we would like to keep the last month of information in a different CSV. We are also going to save January to November to a different CSV as well.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Divide-your-Main-Dataset-Into-Two-different-Dataframe-One-for-Training-and-one-to-check-your-Forecasting-Result-and-Compare-them-with-Actual-Results.">Divide your Main Dataset Into Two different Dataframe One for Training and one to check your Forecasting Result and Compare them with Actual Results.<a class="anchor-link" href="#Divide-your-Main-Dataset-Into-Two-different-Dataframe-One-for-Training-and-one-to-check-your-Forecasting-Result-and-Compare-them-with-Actual-Results."> </a></h4><p>You can divide your data accroding to timestammp column (90% for Training and 10% for Testing)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">jan_to_oct</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s1">&#39;2014-01-01&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="s1">&#39;2014-10-31&#39;</span><span class="p">)]</span>

<span class="c1"># Select the month of December for another dataframe.</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../../common/data/item-demand-time.csv&quot;</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">object</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;item&#39;</span><span class="p">])</span>
<span class="n">remaining_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s1">&#39;2014-10-31&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="s1">&#39;2014-12-01&#39;</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now export them to CSV files and place them into your <code>data</code> folder.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">jan_to_oct</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;data/item-demand-time-train.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">remaining_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;data/item-demand-time-validation.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>At this time the data is ready to be sent to S3 where Forecast will use it later. The following cells will upload the data to S3.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;elec_data/item-demand-time-train.csv&quot;</span>

<span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span><span class="s2">&quot;data/item-demand-time-train.csv&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Creating-the-Dataset-Group-and-Dataset-">Creating the Dataset Group and Dataset <a class="anchor" id="dataset" /><a class="anchor-link" href="#Creating-the-Dataset-Group-and-Dataset-"> </a></h2><p>In Amazon Forecast , a dataset is a collection of file(s) which contain data that is relevant for a forecasting task. A dataset must conform to a schema provided by Amazon Forecast.</p>
<p>More details about <code>Domain</code> and dataset type can be found on the <a href="https://docs.aws.amazon.com/forecast/latest/dg/howitworks-domains-ds-types.html">documentation</a> . For this example, we are using <a href="https://docs.aws.amazon.com/forecast/latest/dg/custom-domain.html">CUSTOM</a> domain with 3 required attributes <code>timestamp</code>, <code>target_value</code> and <code>item_id</code>.</p>
<p>It is importan to also convey how Amazon Forecast can understand your time-series information. That the cell immediately below does that, the next one configures your variable names for the Project, DatasetGroup, and Dataset.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DATASET_FREQUENCY</span> <span class="o">=</span> <span class="s2">&quot;H&quot;</span> 

<span class="c1"># TIMESTAMP_FORMAT:- &quot;yyyy-MM-dd&quot;, &quot;yyyy-MM-dd hh:mm:ss&quot;</span>
<span class="n">TIMESTAMP_FORMAT</span> <span class="o">=</span> <span class="s2">&quot;yyyy-MM-dd hh:mm:ss&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">project</span> <span class="o">=</span> <span class="s1">&#39;util_power_forecastdemo&#39;</span>
<span class="n">datasetName</span><span class="o">=</span> <span class="n">project</span><span class="o">+</span><span class="s1">&#39;_ds&#39;</span>
<span class="n">datasetGroupName</span><span class="o">=</span> <span class="n">project</span> <span class="o">+</span><span class="s1">&#39;_dsg&#39;</span>
<span class="n">s3DataPath</span> <span class="o">=</span> <span class="s2">&quot;s3://&quot;</span><span class="o">+</span><span class="n">bucket_name</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="n">key</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-the-Dataset-Group">Create the Dataset Group<a class="anchor-link" href="#Create-the-Dataset-Group"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">create_dataset_group_response</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">create_dataset_group</span><span class="p">(</span><span class="n">DatasetGroupName</span><span class="o">=</span><span class="n">datasetGroupName</span><span class="p">,</span>
                                                              <span class="n">Domain</span><span class="o">=</span><span class="s2">&quot;CUSTOM&quot;</span><span class="p">,</span>
                                                             <span class="p">)</span>
<span class="n">datasetGroupArn</span> <span class="o">=</span> <span class="n">create_dataset_group_response</span><span class="p">[</span><span class="s1">&#39;DatasetGroupArn&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">forecast</span><span class="o">.</span><span class="n">describe_dataset_group</span><span class="p">(</span><span class="n">DatasetGroupArn</span><span class="o">=</span><span class="n">datasetGroupArn</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-the-Schema">Create the Schema<a class="anchor-link" href="#Create-the-Schema"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># &quot;AttributeType&quot;: &quot;string|datetime|float&quot;</span>
<span class="n">schema</span> <span class="o">=</span><span class="p">{</span>
   <span class="s2">&quot;Attributes&quot;</span><span class="p">:[</span>
      <span class="p">{</span>
         <span class="s2">&quot;AttributeName&quot;</span><span class="p">:</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span>
         <span class="s2">&quot;AttributeType&quot;</span><span class="p">:</span><span class="s2">&quot;timestamp&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
         <span class="s2">&quot;AttributeName&quot;</span><span class="p">:</span><span class="s2">&quot;target_value&quot;</span><span class="p">,</span>
         <span class="s2">&quot;AttributeType&quot;</span><span class="p">:</span><span class="s2">&quot;float&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
         <span class="s2">&quot;AttributeName&quot;</span><span class="p">:</span><span class="s2">&quot;item_id&quot;</span><span class="p">,</span>
         <span class="s2">&quot;AttributeType&quot;</span><span class="p">:</span><span class="s2">&quot;string&quot;</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-the-Dataset">Create the Dataset<a class="anchor-link" href="#Create-the-Dataset"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># &quot;DatasetType&quot;: &quot;&#39;TARGET_TIME_SERIES&#39;|&#39;RELATED_TIME_SERIES|ITEM_METADATA&#39;&quot;</span>

<span class="n">response</span><span class="o">=</span><span class="n">forecast</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
                    <span class="n">Domain</span><span class="o">=</span><span class="s2">&quot;CUSTOM&quot;</span><span class="p">,</span>
                    <span class="n">DatasetType</span><span class="o">=</span><span class="s1">&#39;TARGET_TIME_SERIES&#39;</span><span class="p">,</span>
                    <span class="n">DatasetName</span><span class="o">=</span><span class="n">datasetName</span><span class="p">,</span>
                    <span class="n">DataFrequency</span><span class="o">=</span><span class="n">DATASET_FREQUENCY</span><span class="p">,</span> 
                    <span class="n">Schema</span> <span class="o">=</span> <span class="n">schema</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">datasetArn</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;DatasetArn&#39;</span><span class="p">]</span>
<span class="n">forecast</span><span class="o">.</span><span class="n">describe_dataset</span><span class="p">(</span><span class="n">DatasetArn</span><span class="o">=</span><span class="n">datasetArn</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Add-Dataset-to-Dataset-Group">Add Dataset to Dataset Group<a class="anchor-link" href="#Add-Dataset-to-Dataset-Group"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">forecast</span><span class="o">.</span><span class="n">update_dataset_group</span><span class="p">(</span><span class="n">DatasetGroupArn</span><span class="o">=</span><span class="n">datasetGroupArn</span><span class="p">,</span> <span class="n">DatasetArns</span><span class="o">=</span><span class="p">[</span><span class="n">datasetArn</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-IAM-Role-for-Forecast">Create IAM Role for Forecast<a class="anchor-link" href="#Create-IAM-Role-for-Forecast"> </a></h3><p>Like many AWS services, Forecast will need to assume an IAM role in order to interact with your S3 resources securely. In the sample notebooks, we use the get_or_create_iam_role() utility function to create an IAM role. Please refer to <a href="../../common/util/fcst_utils.py">"notebooks/common/util/fcst_utils.py"</a> for implementation.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">role_name</span> <span class="o">=</span> <span class="s2">&quot;ForecastNotebookRole-demo&quot;</span>
<span class="n">role_arn</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_or_create_iam_role</span><span class="p">(</span> <span class="n">role_name</span> <span class="o">=</span> <span class="n">role_name</span> <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-Data-Import-Job">Create Data Import Job<a class="anchor-link" href="#Create-Data-Import-Job"> </a></h3><p>Now that Forecast knows how to understand the CSV we are providing, the next step is to import the data from S3 into Amazon Forecaast.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">datasetImportJobName</span> <span class="o">=</span> <span class="s1">&#39;EP_DSIMPORT_JOB_TARGET&#39;</span>
<span class="n">ds_import_job_response</span><span class="o">=</span><span class="n">forecast</span><span class="o">.</span><span class="n">create_dataset_import_job</span><span class="p">(</span><span class="n">DatasetImportJobName</span><span class="o">=</span><span class="n">datasetImportJobName</span><span class="p">,</span>
                                                          <span class="n">DatasetArn</span><span class="o">=</span><span class="n">datasetArn</span><span class="p">,</span>
                                                          <span class="n">DataSource</span><span class="o">=</span> <span class="p">{</span>
                                                              <span class="s2">&quot;S3Config&quot;</span> <span class="p">:</span> <span class="p">{</span>
                                                                 <span class="s2">&quot;Path&quot;</span><span class="p">:</span><span class="n">s3DataPath</span><span class="p">,</span>
                                                                 <span class="s2">&quot;RoleArn&quot;</span><span class="p">:</span> <span class="n">role_arn</span>
                                                              <span class="p">}</span> 
                                                          <span class="p">},</span>
                                                          <span class="n">TimestampFormat</span><span class="o">=</span><span class="n">TIMESTAMP_FORMAT</span>
                                                         <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ds_import_job_arn</span><span class="o">=</span><span class="n">ds_import_job_response</span><span class="p">[</span><span class="s1">&#39;DatasetImportJobArn&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ds_import_job_arn</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Check the status of dataset, when the status change from <strong>CREATE_IN_PROGRESS</strong> to <strong>ACTIVE</strong>, we can continue to next steps. Depending on the data size. It can take 10 mins to be <strong>ACTIVE</strong>. This process will take 5 to 10 minutes.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">status_indicator</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">StatusIndicator</span><span class="p">()</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">describe_dataset_import_job</span><span class="p">(</span><span class="n">DatasetImportJobArn</span><span class="o">=</span><span class="n">ds_import_job_arn</span><span class="p">)[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span>
    <span class="n">status_indicator</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ACTIVE&#39;</span><span class="p">,</span> <span class="s1">&#39;CREATE_FAILED&#39;</span><span class="p">):</span> <span class="k">break</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="n">status_indicator</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">forecast</span><span class="o">.</span><span class="n">describe_dataset_import_job</span><span class="p">(</span><span class="n">DatasetImportJobArn</span><span class="o">=</span><span class="n">ds_import_job_arn</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Building-Your-Predictor">Building Your Predictor<a class="anchor-link" href="#Building-Your-Predictor"> </a></h1><p>The overall process for this is:</p>
<ul>
<li>Create a Predictor</li>
<li>Deploy a Predictor</li>
<li>Obtain a Forecast</li>
</ul>
<p>To get started, simply execute the cells below:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-a-Predictor">Create a Predictor<a class="anchor-link" href="#Create-a-Predictor"> </a></h2><p>Now in the previous Cells, your data was imported to be used by Forecast, here we will once again define your dataset information and then start building your model or predictor.</p>
<p>Forecasthorizon is the number of number of time points to predicted in the future. For weekly data, a value of 12 means 12 weeks. for hourly data, we try forecast the next day, so we can set to 24.</p>
<p>Algorithm:-
If you are unsure of which algorithm to use to train your model, choose AutoML when creating a predictor and let Forecast select the optimal algorithm for your datasets. Otherwise, you can manually select one of the built-in algorithms.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">predictorName</span><span class="o">=</span> <span class="n">project</span><span class="o">+</span><span class="s1">&#39;_deeparp_algo&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">forecastHorizon</span> <span class="o">=</span> <span class="mi">24</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="ALgorithms">ALgorithms<a class="anchor-link" href="#ALgorithms"> </a></h4><ol>
<li>Amazon Forecast CNN-QR, Convolutional Neural Network - Quantile Regression :-  arn:aws:forecast:::algorithm/CNN-QR  </li>
<li>Amazon Forecast DeepAR+ is a proprietary machine learning algorithm :-  arn:aws:forecast:::algorithm/Deep_AR_Plus</li>
<li>Prophet is a time series forecasting algorithm :- arn:aws:forecast:::algorithm/Prophet</li>
<li>The Amazon Forecast Non-Parametric Time Series (NPTS) proprietary algorithm :- arn:aws:forecast:::algorithm/NPTS</li>
<li>Autoregressive Integrated Moving Average (ARIMA) :- arn:aws:forecast:::algorithm/ARIMA</li>
<li>Exponential Smoothing (ETS) is a commonly used statistical algorithm :- arn:aws:forecast:::algorithm/ETS</li>
</ol>
<p>For Detail Information:- <a href="https://docs.aws.amazon.com/forecast/latest/dg/aws-forecast-choosing-recipes.html">https://docs.aws.amazon.com/forecast/latest/dg/aws-forecast-choosing-recipes.html</a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="n">algorithmArn</span> <span class="o">=</span> <span class="s1">&#39;arn:aws:forecast:::algorithm/Deep_AR_Plus&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">create_predictor_response</span><span class="o">=</span><span class="n">forecast</span><span class="o">.</span><span class="n">create_predictor</span><span class="p">(</span><span class="n">PredictorName</span><span class="o">=</span><span class="n">predictorName</span><span class="p">,</span> 
                                                  <span class="n">AlgorithmArn</span><span class="o">=</span><span class="n">algorithmArn</span><span class="p">,</span>
                                                  <span class="n">ForecastHorizon</span><span class="o">=</span><span class="n">forecastHorizon</span><span class="p">,</span>
                                                  <span class="n">PerformAutoML</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                                  <span class="n">PerformHPO</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                  <span class="n">EvaluationParameters</span><span class="o">=</span> <span class="p">{</span><span class="s2">&quot;NumberOfBacktestWindows&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> 
                                                                         <span class="s2">&quot;BackTestWindowOffset&quot;</span><span class="p">:</span> <span class="mi">24</span><span class="p">},</span> 
                                                  <span class="n">InputDataConfig</span><span class="o">=</span> <span class="p">{</span><span class="s2">&quot;DatasetGroupArn&quot;</span><span class="p">:</span> <span class="n">datasetGroupArn</span><span class="p">},</span>
                                                  <span class="n">FeaturizationConfig</span><span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ForecastFrequency&quot;</span><span class="p">:</span> <span class="s2">&quot;H&quot;</span><span class="p">,</span> 
                                                                        <span class="s2">&quot;Featurizations&quot;</span><span class="p">:</span> 
                                                                        <span class="p">[</span>
                                                                          <span class="p">{</span><span class="s2">&quot;AttributeName&quot;</span><span class="p">:</span> <span class="s2">&quot;target_value&quot;</span><span class="p">,</span> 
                                                                           <span class="s2">&quot;FeaturizationPipeline&quot;</span><span class="p">:</span> 
                                                                            <span class="p">[</span>
                                                                              <span class="p">{</span><span class="s2">&quot;FeaturizationMethodName&quot;</span><span class="p">:</span> <span class="s2">&quot;filling&quot;</span><span class="p">,</span> 
                                                                               <span class="s2">&quot;FeaturizationMethodParameters&quot;</span><span class="p">:</span> 
                                                                                <span class="p">{</span><span class="s2">&quot;frontfill&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> 
                                                                                 <span class="s2">&quot;middlefill&quot;</span><span class="p">:</span> <span class="s2">&quot;zero&quot;</span><span class="p">,</span> 
                                                                                 <span class="s2">&quot;backfill&quot;</span><span class="p">:</span> <span class="s2">&quot;zero&quot;</span><span class="p">}</span>
                                                                              <span class="p">}</span>
                                                                            <span class="p">]</span>
                                                                          <span class="p">}</span>
                                                                        <span class="p">]</span>
                                                                       <span class="p">}</span>
                                                 <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">predictor_arn</span><span class="o">=</span><span class="n">create_predictor_response</span><span class="p">[</span><span class="s1">&#39;PredictorArn&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Check the status of the predictor. When the status change from <strong>CREATE_IN_PROGRESS</strong> to <strong>ACTIVE</strong>, we can continue to next steps. Depending on data size, model selection and hyper parameters，it can take 10 mins to more than one hour to be <strong>ACTIVE</strong>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">status_indicator</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">StatusIndicator</span><span class="p">()</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">describe_predictor</span><span class="p">(</span><span class="n">PredictorArn</span><span class="o">=</span><span class="n">predictor_arn</span><span class="p">)[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span>
    <span class="n">status_indicator</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ACTIVE&#39;</span><span class="p">,</span> <span class="s1">&#39;CREATE_FAILED&#39;</span><span class="p">):</span> <span class="k">break</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="n">status_indicator</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Get-Error-Metrics">Get Error Metrics<a class="anchor-link" href="#Get-Error-Metrics"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">forecast</span><span class="o">.</span><span class="n">get_accuracy_metrics</span><span class="p">(</span><span class="n">PredictorArn</span><span class="o">=</span><span class="n">predictor_arn</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-a-Forecast">Create a Forecast<a class="anchor-link" href="#Create-a-Forecast"> </a></h2><p>Now create a forecast using the model that was trained</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">forecastName</span><span class="o">=</span> <span class="n">project</span><span class="o">+</span><span class="s1">&#39;_deeparp_algo_forecast&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">create_forecast_response</span><span class="o">=</span><span class="n">forecast</span><span class="o">.</span><span class="n">create_forecast</span><span class="p">(</span><span class="n">ForecastName</span><span class="o">=</span><span class="n">forecastName</span><span class="p">,</span>
                                                  <span class="n">PredictorArn</span><span class="o">=</span><span class="n">predictor_arn</span><span class="p">)</span>
<span class="n">forecast_arn</span> <span class="o">=</span> <span class="n">create_forecast_response</span><span class="p">[</span><span class="s1">&#39;ForecastArn&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Check the status of the forecast process, when the status change from <strong>CREATE_IN_PROGRESS</strong> to <strong>ACTIVE</strong>, we can continue to next steps. Depending on data size, model selection and hyper parameters，it can take 10 mins to more than one hour to be <strong>ACTIVE</strong>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">status_indicator</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">StatusIndicator</span><span class="p">()</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">describe_forecast</span><span class="p">(</span><span class="n">ForecastArn</span><span class="o">=</span><span class="n">forecast_arn</span><span class="p">)[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span>
    <span class="n">status_indicator</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ACTIVE&#39;</span><span class="p">,</span> <span class="s1">&#39;CREATE_FAILED&#39;</span><span class="p">):</span> <span class="k">break</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="n">status_indicator</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Get-Forecast">Get Forecast<a class="anchor-link" href="#Get-Forecast"> </a></h3><p>Once created, the forecast results are ready and you view them.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">forecast_arn</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="n">forecastResponse</span> <span class="o">=</span> <span class="n">forecastquery</span><span class="o">.</span><span class="n">query_forecast</span><span class="p">(</span>
    <span class="n">ForecastArn</span><span class="o">=</span><span class="n">forecast_arn</span><span class="p">,</span>
    <span class="n">Filters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;item_id&quot;</span><span class="p">:</span><span class="s2">&quot;client_12&quot;</span><span class="p">}</span> 
    <span class="c1"># Specify your filters here</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">forecastResponse</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Evaluating-Your-Forecast">Evaluating Your Forecast<a class="anchor-link" href="#Evaluating-Your-Forecast"> </a></h1><h2 id="You-can-skip-this-step-If-you-dont-want-to-evaluate-on-test-data-and-can-run-directly-to-Export-Forecast-Cell.">You can skip this step If you dont want to evaluate on test data and can run directly to Export Forecast Cell.<a class="anchor-link" href="#You-can-skip-this-step-If-you-dont-want-to-evaluate-on-test-data-and-can-run-directly-to-Export-Forecast-Cell."> </a></h2><p>Now is the time to pull down the predictions from this Predictor, and compare them to the actual observed values. This will let us know the impact of accuracy based on the Forecast.</p>
<p>You can extend the approaches here to compare multiple models or predictors and to determine the impact of improved accuracy on your use case.</p>
<p>Overview:</p>
<ul>
<li>Plotting the Actual Results</li>
<li>Plotting the Prediction</li>
<li>Comparing the Prediction to Actual Results</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Plotting-the-Actual-Results">Plotting the Actual Results<a class="anchor-link" href="#Plotting-the-Actual-Results"> </a></h2><p>Take a samll dataframe and plot the result  during that timestamp to evaluate the results.</p>
<p>In the first Part of  notebook we created a file of observed values, we are now going to select a given date and customer from that dataframe and are going to plot the actual usage data for that customer.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">actual_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/item-demand-time-validation.csv&quot;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;item&#39;</span><span class="p">])</span>
<span class="n">actual_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next we need to reduce the data to just the day we wish to plot, which is the First of November 2014.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">actual_df</span> <span class="o">=</span> <span class="n">actual_df</span><span class="p">[(</span><span class="n">actual_df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s1">&#39;2014-10-31&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">actual_df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">&#39;2014-11-01&#39;</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Lastly, only grab the items for client_12 (Any Single customer to visualize more properly)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">actual_df</span> <span class="o">=</span> <span class="n">actual_df</span><span class="p">[(</span><span class="n">actual_df</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;client_12&#39;</span><span class="p">)]</span>
<span class="n">actual_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">actual_df</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Plotting-the-Prediction:">Plotting the Prediction:<a class="anchor-link" href="#Plotting-the-Prediction:"> </a></h2><p>Next we need to convert the JSON response from the Predictor to a dataframe that we can plot.</p>
<p>For Info :- <a href="https://docs.aws.amazon.com/forecast/latest/dg/metrics.html">https://docs.aws.amazon.com/forecast/latest/dg/metrics.html</a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">prediction_df_p10</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">forecastResponse</span><span class="p">[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">][</span><span class="s1">&#39;Predictions&#39;</span><span class="p">][</span><span class="s1">&#39;p10&#39;</span><span class="p">])</span>
<span class="n">prediction_df_p10</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">prediction_df_p10</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The above merely did the p10 values, now do the same for p50 and p90.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">prediction_df_p50</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">forecastResponse</span><span class="p">[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">][</span><span class="s1">&#39;Predictions&#39;</span><span class="p">][</span><span class="s1">&#39;p50&#39;</span><span class="p">])</span>
<span class="n">prediction_df_p90</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">forecastResponse</span><span class="p">[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">][</span><span class="s1">&#39;Predictions&#39;</span><span class="p">][</span><span class="s1">&#39;p90&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Comparing-the-Prediction-to-Actual-Results">Comparing the Prediction to Actual Results<a class="anchor-link" href="#Comparing-the-Prediction-to-Actual-Results"> </a></h2><p>After obtaining the dataframes the next task is to plot them together to determine the best fit.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;source&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Import the observed values into the dataframe:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">actual_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">clean_timestamp</span> <span class="o">=</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
    <span class="n">results_df</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;timestamp&#39;</span> <span class="p">:</span> <span class="n">clean_timestamp</span> <span class="p">,</span> <span class="s1">&#39;value&#39;</span> <span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;actual&#39;</span><span class="p">}</span> <span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">results_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">prediction_df_p10</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">clean_timestamp</span> <span class="o">=</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">])</span>
    <span class="n">results_df</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;timestamp&#39;</span> <span class="p">:</span> <span class="n">clean_timestamp</span> <span class="p">,</span> <span class="s1">&#39;value&#39;</span> <span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">],</span> <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;p10&#39;</span><span class="p">}</span> <span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">prediction_df_p50</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">clean_timestamp</span> <span class="o">=</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">])</span>
    <span class="n">results_df</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;timestamp&#39;</span> <span class="p">:</span> <span class="n">clean_timestamp</span> <span class="p">,</span> <span class="s1">&#39;value&#39;</span> <span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">],</span> <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;p50&#39;</span><span class="p">}</span> <span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">prediction_df_p90</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">clean_timestamp</span> <span class="o">=</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">])</span>
    <span class="n">results_df</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;timestamp&#39;</span> <span class="p">:</span> <span class="n">clean_timestamp</span> <span class="p">,</span> <span class="s1">&#39;value&#39;</span> <span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">],</span> <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="s1">&#39;p90&#39;</span><span class="p">}</span> <span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">results_df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pivot_df</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>

<span class="n">pivot_df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pivot_df</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Export-Forecast">Export Forecast<a class="anchor-link" href="#Export-Forecast"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">forecastExportName</span><span class="o">=</span> <span class="n">project</span><span class="o">+</span><span class="s1">&#39;_deeparp_forecast_export&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">outputPath</span><span class="o">=</span><span class="s2">&quot;s3://&quot;</span><span class="o">+</span><span class="n">bucket_name</span><span class="o">+</span><span class="s2">&quot;/output&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">forecast_export_response</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">create_forecast_export_job</span><span class="p">(</span>
                                                                <span class="n">ForecastExportJobName</span> <span class="o">=</span> <span class="n">forecastExportName</span><span class="p">,</span>
                                                                <span class="n">ForecastArn</span><span class="o">=</span><span class="n">forecastArn</span><span class="p">,</span> 
                                                                <span class="n">Destination</span> <span class="o">=</span> <span class="p">{</span>
                                                                   <span class="s2">&quot;S3Config&quot;</span> <span class="p">:</span> <span class="p">{</span>
                                                                       <span class="s2">&quot;Path&quot;</span><span class="p">:</span><span class="n">outputPath</span><span class="p">,</span>
                                                                       <span class="s2">&quot;RoleArn&quot;</span><span class="p">:</span> <span class="n">role_arn</span>
                                                                   <span class="p">}</span> 
                                                                <span class="p">}</span>
                                                              <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">forecastExportJobArn</span> <span class="o">=</span> <span class="n">forecast_export_response</span><span class="p">[</span><span class="s1">&#39;ForecastExportJobArn&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">status_indicator</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">StatusIndicator</span><span class="p">()</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">describe_forecast_export_job</span><span class="p">(</span><span class="n">ForecastExportJobArn</span><span class="o">=</span><span class="n">forecastExportJobArn</span><span class="p">)[</span><span class="s1">&#39;Status&#39;</span><span class="p">]</span>
    <span class="n">status_indicator</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ACTIVE&#39;</span><span class="p">,</span> <span class="s1">&#39;CREATE_FAILED&#39;</span><span class="p">):</span> <span class="k">break</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="n">status_indicator</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Check s3 bucket for results</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s3</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucketName</span><span class="p">,</span><span class="n">Prefix</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Once you are done exporting this Forecast you can cleanup all the work that was done by executing the below cells.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Cleanup">Cleanup<a class="anchor-link" href="#Cleanup"> </a></h1><p>After building completing the notebooks you may want to delete the following to prevent any unwanted charges:</p>
<ul>
<li>Forecasts</li>
<li>Predictors</li>
<li>Datasets</li>
<li>Dataset Groups</li>
</ul>
<h2 id="Imports-and-Connections-to-AWS">Imports and Connections to AWS<a class="anchor-link" href="#Imports-and-Connections-to-AWS"> </a></h2><p>The following lines import all the necessary libraries and then connect you to Amazon Forecast.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Defining-the-Things-to-Cleanup">Defining the Things to Cleanup<a class="anchor-link" href="#Defining-the-Things-to-Cleanup"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">util</span><span class="o">.</span><span class="n">wait_till_delete</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">forecast</span><span class="o">.</span><span class="n">delete_forecast</span><span class="p">(</span><span class="n">ForecastArn</span><span class="o">=</span><span class="n">forecast_arn</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">util</span><span class="o">.</span><span class="n">wait_till_delete</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">forecast</span><span class="o">.</span><span class="n">delete_predictor</span><span class="p">(</span><span class="n">PredictorArn</span><span class="o">=</span><span class="n">predictor_arn</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">util</span><span class="o">.</span><span class="n">wait_till_delete</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">forecast</span><span class="o">.</span><span class="n">delete_dataset_import_job</span><span class="p">(</span><span class="n">DatasetImportJobArn</span><span class="o">=</span><span class="n">ds_import_job_arn</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">util</span><span class="o">.</span><span class="n">wait_till_delete</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">forecast</span><span class="o">.</span><span class="n">delete_dataset</span><span class="p">(</span><span class="n">DatasetArn</span><span class="o">=</span><span class="n">datasetArn</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">util</span><span class="o">.</span><span class="n">wait_till_delete</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">forecast</span><span class="o">.</span><span class="n">delete_dataset_group</span><span class="p">(</span><span class="n">DatasetGroupArn</span><span class="o">=</span><span class="n">datasetGroupArn</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="IAM-Role-and-Policy-Cleanup">IAM Role and Policy Cleanup<a class="anchor-link" href="#IAM-Role-and-Policy-Cleanup"> </a></h2><p>The very last step in the notebooks is to remove the policies that were attached to a role and then to delete it. No changes should need to be made here, just execute the cell.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">util</span><span class="o">.</span><span class="n">delete_iam_role</span><span class="p">(</span><span class="n">role_name</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>All that remains to cleanup here is to now go back to the CloudFormation console and delete the stack. You have successfully removed all resources that were created.</p>

</div>
</div>
</div>
</div>
 

